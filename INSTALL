==Basic Installation Instructions==

===Prerequisites===

1. PostgreSQL > 8.2
2. Apache2 Webserver
3. PHP 5

sudo apt-get install libapache2-mod-php5 php5-pgsql imagemagick

== Ubuntu 10.10 ==

The git repository is hosted here::

	http://pacific.mpi-cbg.de/cgi-bin/gitweb.cgi

0. Clone the repository into /var/www/catmaid so that you have
the folder /var/www/catmaid/httpdocs/ in place

1. PostgresSQL

https://help.ubuntu.com/community/PostgreSQL

	sudo apt-get install postgresql pgadmin3 phppgadmin postgresql-contrib

Update the password for your catmaid user in /var/www/catmaid/docs/createuser.sql

	sudo -u postgres psql < docs/createuser.sql

Dump the database in docs/master.sql::

	sudo -u postgres psql catmaid < docs/master.sql

Check if you can login and see the contents::

	http://localhost/phppgadmin/

Make sure that the catmaid database is accessible using MD5 hashed
passwords - you have to add this line as the *first* rule in
/etc/postgresql/8.4/main/pg_hba.conf:

	local   catmaid     catmaid_user          md5

After the above please restart the database:

  sudo /etc/init.d/posgresql-8.4 restart

Update catmaid database connection for user in
inc/setup.inc.php.template and rename the file to
inc/setup.inc

2. Apache2 Server

There are two possibilities here - setting up CATMAID on
its own virtual host, or setting it up as a subdirectory
of an existing host:

2.1 Named Virtual Hosts approach:

http://wiki.ubuntuusers.de/Apache/Virtual_Hosts

Your clone of the CATMAID source code should be *outside* any
web-accessible directory.  For example, let's say that you have the
source code in /home/bob/catmaid/

Create a directory for the log files, for example with:

   sudo mkdir -p /var/log/apache2/catmaid/

Create in /etc/apache2/sites-available a file called "catmaid":
----
<VirtualHost *:80>
    ServerName catmaid

    DocumentRoot "/home/bob/catmaid/httpdocs/"

    php_admin_value register_globals off
    php_admin_value include_path ".:/home/bob/catmaid/inc"
    php_admin_value session.use_only_cookies 1
    php_admin_value error_reporting 2047
    php_admin_value display_errors true

    <Directory /home/bob/catmaid/httpdocs/>

        Options FollowSymLinks
        AllowOverride AuthConfig Limit FileInfo

        Order allow,deny
        allow from all

    </Directory>

    CustomLog /var/log/apache2/catmaid/access_log combined
    ErrorLog /var/log/apache2/catmaid/error.log

</VirtualHost>
---

... then make apache aware of the virtual host:
	sudo a2ensite catmaid

... then restart apache:
	/etc/init.d/apache2 restart

... and finally add this entry to "/etc/hosts" :

127.0.0.1	catmaid


2.2 As a directory of an existing virtual host

<VirtualHost *:80>
        ServerAdmin webmaster@localhost

        DocumentRoot /var/www
        <Directory />
                Options FollowSymLinks
                AllowOverride None
        </Directory>
	...
	...

	# Add CATMAID configuration here:
        # CATMAID stuff:
        php_admin_value register_globals off
        php_admin_value include_path ".:/home/mark/catmaid-local-instance/inc"
        php_admin_value session.use_only_cookies 1
        php_admin_value error_reporting 2047
        php_admin_value display_errors true

        Alias /catmaid/ /home/mark/catmaid-local-instance/httpdocs/
        <Directory /home/mark/catmaid-local-instance/httpdocs/>
                Options FollowSymLinks
                AllowOverride AuthConfig Limit FileInfo
                Order allow,deny
                Allow from all
        </Directory>

	...
	...
</VirtualHost>


3. Now try it out!

Try to start CATMAID::

	firefox http://catmaid/

And use the default login::

	user: gerhard
	pass: gerhard

4. Adding a new project

You can generate the image tiles for a stack with the scripts/tile_stack
script or by exporting from TrakEM2 with its "Export > Flat Images" option
and selecting the "Export for web" checkbox.

Then you can create a new project with the script scripts/create_project_stack.py 

Usage: create-project.py <host> <database-name>

The script enables the generation of a new project or uses an existing project.
For a new project, it creates the classes and relations necessary for SVG-based
annotation and associates the project with the users.
It enables the creation of new stacks associated with the project.

More details about the data model can be found in docs/data-model.lyx - a PDF
generated from that file can be found here:

  http://incf.ini.uzh.ch/docs/catmaid-data-model.pdf
